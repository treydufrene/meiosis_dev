\documentclass[12pt]{report}
\usepackage[margin=1in]{geometry}
\usepackage{setspace} % for single/doublespacing commands
\usepackage{graphicx} % including graphics
\usepackage{sectsty} % sexy section headings
\usepackage{pdfpages} % including multipage pdfs
\usepackage[export]{adjustbox} % for graphic frames and center
\usepackage{siunitx}
\usepackage[numbered]{matlab-prettifier} % including matlab w/ syntax highlighting
\usepackage[T1]{fontenc} % prettier matlab font
\usepackage{xfrac} % more legible inline fractions (\sfrac)
\usepackage{lmodern} % font package for above
\usepackage{multicol} % multiple columns
\usepackage[justification=centering]{caption} % figure captions (force centering)
\usepackage{amsmath} % more math symbols and shit
\usepackage{enumitem} % add arguments for enumerate to change style
\usepackage[list=true]{subcaption} % subfigures with list of figure support
\usepackage{multirow}
\usepackage{mathtools}
\usepackage{booktabs}
\usepackage{color}
\usepackage{ulem}
\usepackage{blindtext}
\usepackage[numbers]{natbib}
\usepackage{contour}
\usepackage{tabularx}
\usepackage{circuitikz} % drawing fancy shit
\usepackage{cancel} % arrow and cross math cancel symbol
\usepackage{lineno}
\usepackage{framed}
\usepackage{amssymb} % special math symbols
\usepackage{listings}
\usepackage{array}
\usepackage{BOONDOX-cal} % fancy mathtype script
\usepackage{fancyhdr}
\usepackage{flowchart}
\usepackage{color, colortbl}
\usepackage{tocloft}
\usepackage{url}
\usepackage{etoolbox}
% \usepackage{hyperref}

\setlength{\parskip}{\baselineskip}%
\setlength{\parindent}{0pt}%
\setcounter{secnumdepth}{5}
\renewcommand{\bibname}{References}
\sisetup{output-exponent-marker=\ensuremath{\mathrm{e}}}
\newcommand{\PreserveBackslash}[1]{\let\temp=\\#1\let\\=\temp}
\newcolumntype{C}[1]{>{\PreserveBackslash\centering}p{#1}}
\newcolumntype{R}[1]{>{\PreserveBackslash\raggedleft}p{#1}}
\newcolumntype{L}[1]{>{\PreserveBackslash\raggedright}p{#1}}
\lstMakeShortInline[style=Matlab-editor]| % matlab inline escape character
\graphicspath{{images/}}
\renewcommand\thesection{\arabic{section}}
\renewcommand\labelitemi{---}
\lstset{numberstyle=\ttfamily\small\color{gray}}
\renewcommand\linenumberfont{\ttfamily\small\color{gray}}
\setlength\linenumbersep{6mm}
% \hbadness=99999  % or any number >=10000
\apptocmd{\sloppy}{\hbadness 10000\relax}{}{}
\usetikzlibrary{arrows,calc,patterns,angles,quotes}
% \usetikzlibrary{shapes.geometric}
% \usetikzlibrary{decorations.pathmorphing,decorations.pathreplacing} % for snakes!
% \usetikzlibrary{positioning, circuits.logic.US}
\setlength{\cftbeforetoctitleskip}{-2em}
\newcommand{\Lag}{\mathcal{L}} % lagrangian L

\apptocmd{\sloppy}{\hbadness 10000\relax}{}{}
\setlength{\cftbeforetoctitleskip}{-2em}
\allsectionsfont{\raggedright}
\setlist[enumerate]{wide=0pt, widest=99,
                    leftmargin=\parindent,topsep=0pt,partopsep=0pt,
                    label=\thesubsubsection.\alph*,font=\itshape}

\begin{document}
\normalem
\input{coverpage}
\pagenumbering{roman}
% \begin{abstract}
  % Wordy words
% \end{abstract}
{\tableofcontents\let\clearpage\relax\listoffigures\let\clearpage\relax\listoftables}
\clearpage
\newpage

% \section*{List Of Acronyms and Abbreviations}

% \begin{tabular}{rl}
%   $G$~:&Center of gravity of the bar \\
%   $\ell_0$~:& Spring unstretched length  \\
%   $\delta$~:& Spring deflection \\
%   $k$~:& Spring constant \\
%   $h_{b}$~:& Distance to bar ($G$) from datum \\
%   $F_s$~:& Force onto bar due to spring\\
%   $A_{n}$~:& Pin reaction in $\theta$ direction\\
%   $A_{t}$~:& Pin reaction in tangential direction \\
%   $\vec{v}_G$~:& Velocity of bar center of gravity\\
%   $\ddot{\theta}$~:& Angular velocity of spring \\
%   $\ddot{\phi}$~:& Angular velocity of bar\\
%   $\ddot{\ell}_s$~:& Radial acceleration of spring \\
% \end{tabular}
% \normalsize
% \flushleft
% \singlespacing
% \newpage

\pagenumbering{arabic}
\section{Introduction}
\section{Requirements}
\begin{itemize}
  \item The system shall cost the end-user no more than \$1000.
  \item The system shall be fully dexterous without being kinematically redundant.
  \item The system end-effector shall maintain a positional accuracy magnitude of \(\pm 1\) mm and an orientation accuracy of \(\pm 5^{\circ}\) eigen angle from the base frame.
  \item The system end-effector shall maintain a pose repeatability magnitude between 0.1—1.5 mm for the position and \(\pm 4^{\circ}\) eigen angle from the base frame for the orientation.
  \item The system’s reachable workspace shall be a hemisphere with a radius of 300-700 mm.
  \item The system’s dexterous workspace shall contain a hemispherical shell within the reachable workspace with a thickness of 280 mm.
  \item The system shall have a removable end-effector capable of picking and placing a low-odor chisel tip Expo dry erase marker.
  \item The system shall be able to write with a low-odor chisel tip Expo dry erase marker.
  \item The system shall be open source.
  \item The system shall be capable of operating given only desired end-effector cartesian coordinates specified with respect to the base frame.
\end{itemize}
\section{Conceptual Design}

\newpage
\section{Specifications}
\begin{itemize}
  \item The cost for the MEIOSIS team to develop the manipulator shall be no more than \$800.
  \item The system shall consist of six rotational joints connected by four links. The last three joints will create a spherical wrist.
  \item The system shall have no link offsets.
  \item The system shall accommodate a process in which the end user can calibrate the end-effector's position and orientation to within 0.5 mm and 1 degree of the manipulator’s precision.
  \item Joints one and two of the system shall possess an angular error of no more than .025 degrees.
  \item Joint three of the system shall possess an angle error of no more than .03 degrees.
  \item Joints four, five, and six shall possess an angle error of no more than .29 degrees.
  \item The length of link one, two, three, four, and the wrist shall be 220.8 mm, 250 mm, 200 mm, 80 mm, and 52.5 mm respectively.
  \item The rotational limit of joint one, two, three, four, five, and six shall be \(\pm180^{\circ}\), \(-9.7^{\circ}\) to \(177.5^{\circ}\), \(-150.6^{\circ}\) to \(-19.3^{\circ}\), \(\pm180^{\circ}\), \(-180^{\circ}\) to \(-1.6^{\circ}\), and \(\pm180^{\circ}\) respectively.
  \item The system shall use a gripper that can close to 18mm.
  \item The end-effector shall attach to the manipulator using screws configured in a pattern that can accommodate a Dynamixel AX-12A servo.
  \item The end-effector shall be able to support 0.004 Newton meter moments about the axes normal to its gripping surfaces.
  \item The software shall be hosted publicly on an online repository and maintain an MIT license for distribution.
  \item The system shall have a user interface capable of accepting the end-effector’s desired cartesian position and Euler angle orientation as a six element row vector.
  \item The system shall be capable of performing floating point arithmetic.
\end{itemize}


\newpage
\section{Preliminary Design}
\subsection{CAD}
\subsection{Forward Kinematics}
\subsection{Velocity Kinematics}
\subsection{Inverse Kinematics}
\subsection{Equations of Motion}
\subsection{Open-Loop Simulation}
\subsection{Control System}
\subsection{Closed-Loop Simulation}
\subsection{ANSYS}
\subsection{Electrical Schematic}
\subsection{Software Flowchart}
\subsection{Project Status and Future}
\subsection{Parts List}

\newpage
%------------------------------------------------------------------------------%
% FK
%------------------------------------------------------------------------------%
\begin{figure}[htp]
  \centering
  \includegraphics[width=.9\textwidth]{zero}
  \caption{Coordinate Systems}
  \label{fig:coords}
\end{figure}

Given the lengths of each of the manipulator links,
\[
\begin{aligned}
  ^I_Br_1 = \begin{bmatrix} 0\\0\\ \ell_b\end{bmatrix} & \quad
  ^1_1r_2 = \begin{bmatrix} 0\\0\\ \ell_1\end{bmatrix} & \quad
  ^2_2r_3 = \begin{bmatrix} 0\\\ell_2\\ 0\end{bmatrix} & \quad
  ^3_3r_4 = \begin{bmatrix} 0\\\ell_3\\ 0\end{bmatrix} & \quad
  ^4_4r_5 = \begin{bmatrix} 0\\\ell_4\\ 0\end{bmatrix} & \quad
  ^5_5r_6 = \begin{bmatrix} 0\\\ell_5\\ 0\end{bmatrix} & \quad
\end{aligned}
\]
The position of each link relative to the inertial frame is given as:
\[
\begin{aligned}
^I_Br_1 &= {}_Br_1 &\quad
^I_Br_2 &= r_1 + {}^IT_1 {}^1_1r_2 &\quad
^I_Br_3 &= r_2 + {}^IT_2 {}^2_2r_3 \\[.5em]
^I_Br_4 &= r_3 + {}^IT_3 {}^3_3r_4 &\quad
^I_Br_5 &= r_4 + {}^IT_4 {}^4_4r_5 &\quad
^I_Br_6 &= r_5 + {}^IT_5 {}^5_5r_6
\end{aligned}
\]

\[
\begin{aligned}
  ^I_Br_1 =&
  \begin{bmatrix}
    0\\ 0\\ \ell_b
  \end{bmatrix} & \quad
  ^I_Br_2 =
  \begin{bmatrix}
    0\\ 0\\ \ell_b + \ell_1
  \end{bmatrix} & \quad
  ^I_Br_3 =
  \begin{bmatrix}
    -\ell_2c_{\theta_2}s_{\theta_1}\\
    \ell_2c_{\theta_{12}}\\
    \ell_b+\ell_1+\ell_2s_{\theta_2}
  \end{bmatrix} & \quad
  ^I_Br_4 =
  \begin{bmatrix}
    -s_{\theta_1}(\ell_3c_{\theta_{23}} + \ell_2c_{\theta_2}) \\
    c_{\theta_1}(\ell_3c_{\theta_{23}} + \ell_2c_{\theta_2}) \\
    \ell_1 + \ell_b + \ell_3s_{\theta_{23}} + \ell_2s_{\theta_2}
  \end{bmatrix} \\
\end{aligned}
  \]
  \[
  ^I_Br_5 =
  \begin{bmatrix}
    -s_{\theta_1}(\ell_3c_{\theta_{23}} + \ell_4c_{\theta_{23}} + \ell_2c_{\theta_2}) \\
    c_{\theta_1}(\ell_3c_{\theta_{23}} + \ell_4c_{\theta_{23}} + \ell_2c_{\theta_2}) \\
    \ell_1 + \ell_b + \ell_3s_{\theta_{23}} + \ell_4s_{\theta_{23}} + \ell_2s_{\theta_2}
  \end{bmatrix}
  \]
  \[
  ^I_Br_6 =
  \begin{bmatrix}
  \begin{aligned}
      &\ell_5c_{\theta_1}s_{\theta_4}s_{\theta_5} - \ell_4c_{\theta_{23}}s_{\theta_1} - \ell_2c_{\theta_2}s_{\theta_1} - \ell_5c_{\theta_{23}}c_{\theta_5}s_{\theta_1} - \ell_3c_{\theta_{23}}s_{\theta_1} \\
      &\qquad\qquad+ \ell_5c_{\theta_2}c_{\theta_4}s_{\theta_1}s_{\theta_3}s_{\theta_5} + \ell_5c_{\theta_3}c_{\theta_4}s_{\theta_1}s_{\theta_2}s_{\theta_5} \\
      &\ell_5(s_{\theta_5}(s_{\theta_1}s_{\theta_4} - c_{\theta_4}(c_{\theta_1}c_{\theta_2}s_{\theta_3} + c_{\theta_1}c_{\theta_3}s_{\theta_2})) - c_{\theta_5}(c_{\theta_1}s_{\theta_2}s_{\theta_3} - c_{\theta_1}c_{\theta_2}c_{\theta_3})) \\
      &\qquad\qquad -\ell_3(c_{\theta_1}s_{\theta_2}s_{\theta_3} - c_{\theta_1}c_{\theta_2}c_{\theta_3}) -\ell_4(c_{\theta_1}s_{\theta_2}s_{\theta_3} - c_{\theta_1}c_{\theta_2}c_{\theta_3}) + \ell_2c_{\theta_1}c_{\theta_2} \\
      &\ell_1 + \ell_b + \ell_3s_{\theta_{23}} + \ell_4s_{\theta_{23}} + \ell_2s_{\theta_2} + \dfrac{\ell_5c_{\theta_{23}}s_{\theta_{45}}}{2} + \ell_5s_{\theta_{23}}c_{\theta_5} - \dfrac{\ell_5s_{\theta_4 - \theta_5}c_{\theta_{23}}}{2}
    \end{aligned}
  \end{bmatrix}
\]
\newpage
The orientation of each link with respect to the inertial frame is given as:
\[
\begin{aligned}
^IT_1 &= rotz(\theta_1) \\
^IT_2 &= rotz(\theta_1)~rotx(\theta_2)\\
^IT_3 &= rotz(\theta_1)~rotx(\theta_2)~rotx(\theta_3)\\
^IT_4 &= rotz(\theta_1)~rotx(\theta_2)~rotx(\theta_3)~roty(\theta_4)\\
^IT_5 &= rotz(\theta_1)~rotx(\theta_2)~rotx(\theta_3)~roty(\theta_4)~rotx(\theta_5)\\
^IT_6 &= rotz(\theta_1)~rotx(\theta_2)~rotx(\theta_3)~roty(\theta_4)~rotx(\theta_5)~roty(\theta_6)\\
\end{aligned}
\]
Given the direction cosine matrices,

\[
rotx(\theta) = \begin{bmatrix}
 1 & 0 & 0\\
 0 & \cos(\theta) & -\sin(\theta) \\
 0 & \sin(\theta) & \cos(\theta)
\end{bmatrix}~,\quad
roty(\theta) = \begin{bmatrix}
 1 & 0 & 0\\
 0 & \cos(\theta) & -\sin(\theta) \\
 0 & \sin(\theta) & \cos(\theta)
\end{bmatrix}
\]
\[
rotz(\theta) = \begin{bmatrix}
 \cos(\theta) & 0 & \sin(\theta)\\
  0 & 1 & 0 \\
 -\sin(\theta) & \cos(\theta) & 0
\end{bmatrix}
\]

\[
\begin{aligned}
  ^IT_1 =
  \begin{bmatrix}
    c_{\theta_1}& -s_{\theta_1}& 0\\
    s_{\theta_1}&  c_{\theta_1}& 0\\
    0&            0& 1\\
  \end{bmatrix} & \quad
  ^IT_2 =
  \begin{bmatrix}
    c_{\theta_1}& -c_{\theta_2}s_{\theta_1}&  s_{\theta_1}s_{\theta_2}\\
    s_{\theta_1}&  c_{\theta_1}c_{\theta_2}& -c_{\theta_1}s_{\theta_2}\\
    0&              s_{\theta_2}&              c_{\theta_2}\\
  \end{bmatrix} & \quad
  ^IT_3 =
  \begin{bmatrix}
    c_{\theta_1}& -c_{\theta_{23}}s_{\theta_1}&  s_{\theta_{23}}s_{\theta_1}\\
    s_{\theta_1}&  c_{\theta_{23}}c_{\theta_1}& -s_{\theta_{23}}c_{\theta_1}\\
    0&              s_{\theta_{23}}&              c_{\theta_{23}}\\
  \end{bmatrix}
\end{aligned}
\]
\[
^IT_4 =
\begin{bmatrix}
c_{\theta_1}c_{\theta_4} - s_{\theta_{23}}s_{\theta_1}s_{\theta_4}& -c_{\theta_{23}}s_{\theta_1}& c_{\theta_1}s_{\theta_4} + s_{\theta_{23}}c_{\theta_4}s_{\theta_1}\\
c_{\theta_4}s_{\theta_1} + s_{\theta_{23}}c_{\theta_1}s_{\theta_4}&  c_{\theta_{23}}c_{\theta_1}& s_{\theta_1}s_{\theta_4} - s_{\theta_{23}}c_{\theta_1}c_{\theta_4}\\
-c_{\theta_{23}}s_{\theta_4}&              s_{\theta_{23}}&                                       c_{\theta_{23}}c_{\theta_4}\\
\end{bmatrix}
\]
\[
^IT_5 =
\begin{bmatrix}
c_{\theta_1}c_{\theta_4} - s_{\theta_{23}}s_{\theta_1}s_{\theta_4}& s_{\theta_5}(c_{\theta_1}s_{\theta_4} + s_{\theta_{23}}c_{\theta_4}s_{\theta_1}) - c_{\theta_{23}}c_{\theta_5}s_{\theta_1}& c_{\theta_5}(c_{\theta_1}s_{\theta_4} +
 s_{\theta_{23}}c_{\theta_4}s_{\theta_1}) + c_{\theta_{23}}s_{\theta_1}s_{\theta_5}\\
c_{\theta_4}s_{\theta_1} + s_{\theta_{23}}c_{\theta_1}s_{\theta_4}& s_{\theta_5}(s_{\theta_1}s_{\theta_4} - s_{\theta_{23}}c_{\theta_1}c_{\theta_4}) + c_{\theta_{23}}c_{\theta_1}c_{\theta_5}& c_{\theta_5}(s_{\theta_1}s_{\theta_4} - s_{\theta_{23}}c_{\theta_1}c_{\theta_4}) - c_{\theta_{23}}c_{\theta_1}s_{\theta_5}\\
-c_{\theta_{23}}s_{\theta_4}&                                                     s_{\theta_{23}}c_{\theta_5} + c_{\theta_{23}}c_{\theta_4}s_{\theta_5}&                                                     c_{\theta_{23}}c_{\theta_4}c_{\theta_5} - s_{\theta_{23}}s_{\theta_5}\\
\end{bmatrix}
\]
\[
^IT_6 =
\begin{bmatrix}
  ^IT_{6(1,1)} & ^IT_{6(1,2)} & ^IT_{6(1,3)}\\
  ^IT_{6(2,1)} & ^IT_{6(2,2)} & ^IT_{6(2,3)}\\
  ^IT_{6(3,1)} & ^IT_{6(3,2)} & ^IT_{6(3,3)}\\
\end{bmatrix}
\]
\[
\begin{aligned}
^IT_{6(1,1)} &=
c_{\theta_6}(c_{\theta_1}c_{\theta_4} - s_{\theta_{23}}s_{\theta_1}s_{\theta_4}) - s_{\theta_6}(c_{\theta_5}(c_{\theta_1}s_{\theta_4} + s_{\theta_{23}}c_{\theta_4}s_{\theta_1}) + c_{\theta_{23}}s_{\theta_1}s_{\theta_5})\\
^IT_{6(1,2)} &=
s_{\theta_5}(c_{\theta_1}s_{\theta_4} + s_{\theta_{23}}c_{\theta_4}s_{\theta_1}) - c_{\theta_{23}}c_{\theta_5}s_{\theta_1}\\
^IT_{6(1,3)} &=
c_{\theta_6}(c_{\theta_5}(c_{\theta_1}s_{\theta_4} + s_{\theta_{23}}c_{\theta_4}s_{\theta_1}) + c_{\theta_{23}}s_{\theta_1}s_{\theta_5}) + s_{\theta_6}(c_{\theta_1}c_{\theta_4} - s_{\theta_{23}}s_{\theta_1}s_{\theta_4})\\
^IT_{6(2,1)} &=
c_{\theta_6}(c_{\theta_4}s_{\theta_1} + s_{\theta_{23}}c_{\theta_1}s_{\theta_4}) - s_{\theta_6}(c_{\theta_5}(s_{\theta_1}s_{\theta_4} - s_{\theta_{23}}c_{\theta_1}c_{\theta_4}) - c_{\theta_{23}}c_{\theta_1}s_{\theta_5})\\
^IT_{6(2,2)} &=
s_{\theta_5}(s_{\theta_1}s_{\theta_4} - s_{\theta_{23}}c_{\theta_1}c_{\theta_4}) + c_{\theta_{23}}c_{\theta_1}c_{\theta_5}\\
^IT_{6(2,3)} &=
s_{\theta_6}(c_{\theta_4}s_{\theta_1} + s_{\theta_{23}}c_{\theta_1}s_{\theta_4}) + c_{\theta_6}(c_{\theta_5}(s_{\theta_1}s_{\theta_4} - s_{\theta_{23}}c_{\theta_1}c_{\theta_4}) - c_{\theta_{23}}c_{\theta_1}s_{\theta_5})\\
^IT_{6(3,1)} &=
s_{\theta_6}(s_{\theta_{23}}s_{\theta_5} - c_{\theta_{23}}c_{\theta_4}c_{\theta_5}) - c_{\theta_{23}}c_{\theta_6}s_{\theta_4}\\
^IT_{6(3,2)} &=
s_{\theta_{23}}c_{\theta_5} + c_{\theta_{23}}c_{\theta_4}s_{\theta_5}\\
^IT_{6(3,3)} &=
c_{\theta_6}(s_{\theta_{23}}s_{\theta_5} - c_{\theta_{23}}c_{\theta_4}c_{\theta_5}) - c_{\theta_{23}}s_{\theta_4}s_{\theta_6}
\end{aligned}
\]
\newpage
%------------------------------------------------------------------------------%
% IK
%------------------------------------------------------------------------------%
The inverse kinematics can be calculated given desired position and orientation vectors, $o$ and $R$, respecitvely.
\[
\begin{bmatrix}x_c & y_c & z_c \end{bmatrix} = o~,\quad
  R =
  \begin{bmatrix}
    r_{11} & r_{12} & r_{13} \\
    r_{21} & r_{22} & r_{23} \\
    r_{31} & r_{32} & r_{33}
  \end{bmatrix}
\]

\begin{equation}
\begin{aligned}
\quad\text{Inverse Position}: \\
\theta_{1}&= \text{atan2} \left(x_{c},~ y_{c}\right) - \text{atan2}\left(d,~\sqrt{x_c^2 + y_c^2 -d^2}\right) - \sfrac{\pi}{2}\\
\theta_{2}&= \text{atan2} \left(z_c - \ell_1, ~\sqrt{x_c^2 + y_c^2 - d^2}\right) - \text{atan2}\left(\ell_3s_3,~\ell_2 + \ell_3c_3\right) \\
\theta_{3}&= \text{atan2} (-\sqrt{1-D^{2}},~ D) \\
& \quad \text { where } D\equiv\frac{x_{c}^{2}+y_{c}^{2}-d^{2}+\left(z_{c}-\ell_{1}\right)^{2}-\ell_{2}^{2}-\ell_{3}^{2}}{2 \ell_{2} \ell_{3}} \\
\quad\text{Inverse Orientation}:\\
^IT_3 &= rotz(\theta_1)~rotx(\theta_2)~rotx(\theta_3) \\
{}^3T_6 &= {}^IT_3^TR \\ % TODO: reference the FK orientation sec#/p.
\theta_4 &= \text{atan2} \left({}^3T_{6(1,2)},~{}^3T_{6(3,2)}\right) \\
\theta_5 &= \text{atan2} \left({{}^3T_{6(3,2)}} / {c_4},~{}^3T_{6(2,2)}\right) \\
\theta_6 &= \text{atan2} \left({}^3T_{6(2,1)},~ -{}^3T_{6(2,3)}\right) \\
\end{aligned}
\nonumber
\end{equation}
\newpage
%------------------------------------------------------------------------------%
% ROBOT EOMS
%------------------------------------------------------------------------------%

\begin{equation}
  H(\gamma)\ddot{\gamma}+d(\gamma,\dot{\gamma})+G(\gamma)+B(\dot{\gamma})+C\text{sgn}(\dot{\gamma}) = F
\end{equation}
\[
J_B =
\begin{bmatrix}
  ^IT_B(:,3)^T \cdot \dfrac{\partial}{\partial\gamma}^IT_B(:,2) \\
  ^IT_B(:,1)^T \cdot \dfrac{\partial}{\partial\gamma}^IT_B(:,3) \\
  ^IT_B(:,2)^T \cdot \dfrac{\partial}{\partial\gamma}^IT_B(:,1) \\
\end{bmatrix}
=
\begin{bmatrix}
  ^B_B\omega_I\\
  ^I_B\dot{r}_B
\end{bmatrix}
\]

\[
^B_B\Gamma = ^B_Br_{cm}m_b~,\quad \mathring{S}(\omega)r=(\omega\times r)
\]

\[
G(\gamma) \equiv \left(\frac{\partial U(^Ir(\gamma))}{\partial\gamma}\right)^T
\]

\[
U_B = \begin{bmatrix} 0 & 0 & g\end{bmatrix}\left(^I_Br_Bm_B + ^IT_B{}_B^B\Gamma\right)
\]

\begin{equation}
  \renewcommand{\arraystretch}{1.5}
  H(\gamma) = \sum_B^N J_B(\gamma)^T
  \begin{bmatrix}
    ^B_BJ & \mathring{S}(^B_B\Gamma) ^IT_B^T\\
    ^IT_B\mathring{S}(^B_B\Gamma)^T & m_BI
  \end{bmatrix}
  J_B(\gamma)
\end{equation}

\begin{equation}
  \renewcommand{\arraystretch}{1.5}
  d(\gamma,\dot{\gamma}) = \sum_B^N J_B(\gamma)^T
  \begin{bmatrix}
    ^B_BJ & \mathring{S}(^B_B\Gamma) ^IT_B^T\\
    ^IT_B\mathring{S}(^B_B\Gamma)^T & m_BI
  \end{bmatrix}
  \dot{J}_B(\gamma,\dot{\gamma})\dot{\gamma}+J_B(\gamma)^T
  \begin{bmatrix}
    ^B_B\omega_I \times ^B_BJ ^B_B\omega_I \\
    ^IT_B\left(^B_B\omega_I\times(^B_B\omega_I\times^B_B\Gamma)\right)
  \end{bmatrix}
\end{equation}




\newpage
%------------------------------------------------------------------------------%
% MOTOR DYNAMICS
%------------------------------------------------------------------------------%
Given robot dynamics described by \(H(\gamma)\ddot{\gamma} + n(\gamma,\dot{\gamma}) = \tau\), the torque, $\tau$, provided by the servo motors is necessary to solve the closed loop dynamics of the system. Assuming the servo is driven by a D.C. motor with proportional derivative control,
\begin{equation}
  \tau_a = Ki_a = J_a\ddot{\theta}_a + b_a\dot{\theta}_a + \tau_L
  \label{eq:motor}
\end{equation}
Where $\tau_a$ is the actuator torque, $K$ is the back-EMF constant, $i_a$ is the motor current, $J_a$ is the armature inertia, $\theta_a,~\dot{\theta}_a,\ddot{\theta}_a$ is the motor position and it's first and second time derivatives, respectively, $b_a$ is the viscous friction coefficient, and $\tau_L$ is the torque available for the actuator to do work. The basic equation for a motor is known to be:
\begin{equation}
  V_a = i_aR_a + K\dot{\theta}_a
  \label{eq:va}
\end{equation}
Where $V_a$ is the voltage applied to the actuator and $R_a$ is the armature resistance. Given a gearbox with $\sfrac{\text{in}}{\text{out}}$ ratio $N$ and efficiency $\eta$,
\input{gearbox}
The motor equation (\ref{eq:motor}) can be expressed in the output coordinates:
\[
Ki_a = J_aN\ddot{\theta} + b_aN\dot{\theta} + \frac{\tau}{N\eta}
\]
Substituing into equation (\ref{eq:va}) and solving for $i_a$:
\[
  i_a = \frac{J_aN}{K}\ddot{\theta} + b_aN\dot{\theta} + \frac{\tau}{N\eta}
\]
\begin{equation}
  V_a = \frac{R_aJ_aN}{K}\ddot{\theta} + \frac{R_ab_aN}{K}\dot{\theta} + \frac{R_a}{KN\eta}\tau + KN\dot{\theta}
  \label{eq:newva}
\end{equation}
Assuming P.D. control, \(V_a = K_p(\theta-\theta_d) + K_d\dot{\theta}\), where $\theta_d$ is the desired orientation of the actuator, the following solution is found by setting the P.D. solution equal to (\ref{eq:newva}). After collecting like terms:

\begin{equation}
  \frac{R_aJ_aN}{K}\ddot{\theta} + \left( \frac{R_aJ_aN}{K} - K_d + KN \right)\dot{\theta} - K_p\theta = -K_p\theta_d - \frac{R_a}{KN\eta}\tau
  \label{eq:end1}
\end{equation}
\newpage
The following parameters of the system can be obtained by applying a step input to the system with $\tau=0$ and measuring the characteristics of it's response. Denoting $\zeta$ as the damping ratio and $\omega_n$ as the natural frequency of the system,
\[
  \text{\% Overshoot} = \left( \frac{\theta_{max} - \theta_{ss}}{\theta_{ss}} \right) \times 100~,\quad \zeta = \frac{-\ln(\sfrac{\%\text{OS}}{100})}{\sqrt{\pi^2 + \ln^2(\sfrac{\%\text{OS}}{100})}}~,\quad \omega_n = \frac{\pi}{T_p\sqrt{1-\zeta^2}}
\]

Given $\theta_{max},~\theta_{ss},$ and $T_p$ as measured parameters of the system's max output, steady state, and time to peak, respectively.

Refactoring equation (\ref{eq:end1}) and equating with the general solution for a second order system given by $\ddot{\theta} + 2\zeta\omega_n\dot{\theta} + \omega_n^2\theta = \omega_n^2\theta_d$,
\begin{equation}
  2\zeta\omega_n = \frac{b_a}{J_a} - \frac{KK_d}{R_aJ_aN} + \frac{K^2}{R_aJ_a}~,\quad
  \omega_n^2 = \frac{-KK_p}{R_aJ_aN}
\end{equation}
Performing a similar experiment as previously described, except with a known inertial load $\tau = J_m\ddot{\theta}$, the following parameters can be found:
\begin{equation}
  \alpha_m \equiv 2\zeta\omega_n = \frac{R_ab_aN^2\eta-KK_dN\eta+K^2N^2\eta}{R_aJ_aN^2\eta+R_aJ_m}~,\quad
  \beta_m \equiv \omega_n =-\frac{KK_pN\eta}{R_aJ_aN^2\eta+R_aJ_m}
\end{equation}

\begin{equation}
\begin{bmatrix}
  1 & -(\alpha_1J_1+\beta_1J_1) \\
  1 & -(\alpha_2J_2+\beta_2J_2) \\
  \vdots & \vdots
\end{bmatrix}
\begin{bmatrix}
  \dfrac{R_ab_aN^2\eta-KK_dN\eta+K^2N^2\eta-KK_pN\eta}{R_aJ_aN^2\eta} \\
  ~\\
  \dfrac{1}{J_aN^2\eta}
\end{bmatrix}
=
\begin{bmatrix}
  \alpha_1+\beta_1 \\
  \alpha_2+\beta_2 \\
  \vdots
\end{bmatrix}
\label{eq:soe}
\end{equation}
Finally, with multiple datasets (varying inertial loads, $J_m$) the coefficients of the second order system equation can be found using the least squares solution of (\ref{eq:soe}).





% \begin{enumerate}[label=\alph*.]
%   \item Description for callout a
%   \item Description for callout b
% \end{enumerate}

% Example citations:
% \cite{DBLP:journals/corr/JohnsonAL16}
% \cite{DBLP:journals/corr/abs-1803-09820}
% \cite{DBLP:journals/corr/RonnebergerFB15}

% \newpage
% \bibliographystyle{plain}
% \bibliography{JohnsonAL16,abs-1803-09820,RonnebergerFB15}

\newpage
\section*{Acknowledgements \& Attributions}
We would like to acknowledge the following people for their contibutions to creating this report\textbf{?}
\begin{itemize}
  \item Dr. Isenberg
  \item Dr. Schipper
\end{itemize}

\newpage
\appendix
\renewcommand\thesection{\Roman{section}}
\renewcommand\thesubsection{\roman{subsection}}
\section{Appendix}\label{sec:app}
\subsection{Drawings}
\subsection{Salient Code}
% Code listing
%\begin{lstlisting}[frame=lines,style=Matlab-editor,basicstyle = \mlttfamily, caption=Example Code
% Code Here
%\end{lstlisting}
% \includepdf[landscape,pages=-]{pdfname}

\end{document}
